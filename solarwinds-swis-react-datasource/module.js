/* [create-plugin] version: 5.12.4 */
define(["@grafana/ui","rxjs","module","@grafana/runtime","@grafana/data","react"],((e,t,r,n,a,o)=>(()=>{"use strict";var i={7:t=>{t.exports=e},88:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},269:e=>{e.exports=t},278:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(n)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);n&&i[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),r&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=r):u[2]=r),a&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=a):u[4]="".concat(a)),t.push(u))}},t}},292:e=>{var t=[];function r(e){for(var r=-1,n=0;n<t.length;n++)if(t[n].identifier===e){r=n;break}return r}function n(e,n){for(var o={},i=[],s=0;s<e.length;s++){var l=e[s],c=n.base?l[0]+n.base:l[0],u=o[c]||0,m="".concat(c," ").concat(u);o[c]=u+1;var d=r(m),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var f=a(p,n);n.byIndex=s,t.splice(s,0,{identifier:m,updater:f,references:1})}i.push(m)}return i}function a(e,t){var r=t.domAPI(t);r.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,a){var o=n(e=e||[],a=a||{});return function(e){e=e||[];for(var i=0;i<o.length;i++){var s=r(o[i]);t[s].references--}for(var l=n(e,a),c=0;c<o.length;c++){var u=r(o[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}o=l}}},308:e=>{e.exports=r},383:e=>{var t={};e.exports=function(e,r){var n=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},486:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(942),a=r.n(n),o=r(278),i=r.n(o)()(a());i.push([e.id,".generic-datasource-query-row .query-keyword {\n  width: 75px;\n}","",{version:3,sources:["webpack://./styles/QueryEditor.css"],names:[],mappings:"AAAA;EACE,WAAW;AACb",sourcesContent:[".generic-datasource-query-row .query-keyword {\n  width: 75px;\n}"],sourceRoot:""}]);const s=i},531:e=>{e.exports=n},739:(e,t,r)=>{r.d(t,{SwisDatasource:()=>m});var n=r(781),a=r(531),o=r(269);function i(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function s(e){i(o,n,a,s,l,"next",e)}function l(e){i(o,n,a,s,l,"throw",e)}s(void 0)}))}}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){l(e,t,r[t])}))}return e}function u(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class m extends n.DataSourceApi{testDatasource(){return s((function*(){try{const e=yield this.doRequest({url:this.url+"/Query?query=SELECT Description FROM System.NullEntity",method:"GET"});return 200===e.status?{status:"success",message:"Data source is working :)",title:"Success"}:{status:"error",message:`Error connecting to SWIS: ${e.statusText}`,title:"Error"}}catch(e){return{status:"error",message:`Error connecting to SWIS: ${e}`,title:"Error"}}})).call(this)}interpolateVariable(e,t){return"string"==typeof e&&(t.multi||t.includeAll)?"'"+e.replace(/'/g,"''")+"'":e}query(e){return s((function*(){const t=e.targets.filter((e=>!e.hide)).map((t=>({refId:t.refId,intervalMs:e.intervalMs,maxDataPoints:e.maxDataPoints,rawSql:t.rawSql,format:t.format})));if(0===t.length)return{data:[]};try{const r=t.map((t=>this.doQuery(t,e))),n=yield Promise.all(r);return{data:n.flat()}}catch(e){throw console.error("Query error:",e),e}})).call(this)}doQuery(e,t){return s((function*(){let r=e.rawSql;r=r.replace(/\$from/g,"@timeFrom"),r=r.replace(/\$to/g,"@timeTo"),r=(0,a.getTemplateSrv)().replace(r,t.scopedVars,this.interpolateVariable),e.rawSql=r;const n={query:this.resolveMacros(e.rawSql,t),parameters:{timeFrom:t.range?t.range.from.toISOString():"",timeTo:t.range?t.range.to.toISOString():"",granularity:Math.max(Math.floor((t.intervalMs||0)/1e3),1)}};e.options=t;try{const t=yield this.doRequest({url:this.url+"/Query",method:"POST",data:{query:n.query+" WITH SCHEMAONLY",parameters:n.parameters}});this.processMetadata(t,e);const r=yield this.doRequest({url:this.url+"/Query",method:"POST",data:n});return this.processQueryResult(r,e)}catch(e){throw console.error("Error executing query:",e),e}})).call(this)}timeSpan(e){const t=e%1e3,r=Math.floor(e/1e3)%60,n=Math.floor(e/6e4)%60,a=Math.floor(e/36e5)%24;return Math.floor(e/864e5)+"."+a+":"+n+":"+r+"."+t}resolveMacros(e,t){return-1===(e=e.replace(/downsample\(([^\)]*)*\)/g,((e,t)=>"ADDSECOND(FLOOR(SecondDiff('1970-01-01T00:00:00', "+t+")/@granularity+1)*@granularity, '1970-01-01T00:00:00')"))).indexOf("GRANULARITY")&&-1!==e.indexOf("downsample")&&(e+=" WITH GRANULARITY '"+this.timeSpan(t.intervalMs||0)+"'"),e}processMetadata(e,t){const r=[],n={timeColumnIndex:-1,metricIndex:-1,columns:r};for(const t of e.data.results)-1!==t.DataType.indexOf("String")?n.metricIndex=t.Index:-1!==t.DataType.indexOf("DateTime")&&(n.timeColumnIndex=t.Index),r.push({index:t.Index,name:t.Alias,type:this.translateType(t.DataType)});if("time_series"===t.format){if(r.length<2)throw new Error("There has to be at least 2 columns defined for Series");if(-1===n.timeColumnIndex)throw new Error("Missing DateTime column which is needed for Series")}t.metadata=n}translateType(e){return-1!==e.indexOf("Int")||-1!==e.indexOf("Double")||-1!==e.indexOf("Decimal")?n.FieldType.number:-1!==e.indexOf("DateTime")?n.FieldType.time:-1!==e.indexOf("Boolean")?n.FieldType.boolean:n.FieldType.string}processQueryResult(e,t){if("table"===t.format)return this.processQueryResultTable(e,t);if("time_series"===t.format)return this.processQueryResultMetric(e,t);if("search"===t.format)return this.processQueryResultSearch(e,t);if("annotation"===t.format)return this.processQueryResultAnnotation(e,t);throw new Error("Unknown query format ["+t.format+"]")}processQueryResultAnnotation(e,t){const r=t.metadata;let n=r.columns.findIndex((e=>"time"===e.name));-1===n&&(n=r.timeColumnIndex);let a=r.columns.findIndex((e=>"text"===e.name));-1===a&&(a=r.metricIndex);const o=r.columns.findIndex((e=>"tags"===e.name));if(-1===n)throw new Error("Missing mandatory column DateTime column or named [time]");return e.data.results.map((e=>Object.keys(e).map((t=>e[t])))).map((e=>({annotation:t.options.annotation,time:this.correctTime(e[n]),text:e[a],tags:e[o]?e[o].trim().split(/\s*,\s*/):[]})))}processQueryResultSearch(e,t){const r=t.metadata,n=r.columns.findIndex((e=>"__text"===e.name)),a=r.columns.findIndex((e=>"__value"===e.name));if(2===r.columns.length&&-1!==n&&-1!==a){const t=r.columns[n],o=r.columns[a];return e.data.results.map((e=>Object.keys(e).map((t=>e[t])))).map((e=>({text:e[t.index],value:e[o.index]})))}throw new Error("Specify __text and __value column")}processQueryResultTable(e,t){const r=new n.MutableDataFrame({refId:t.refId,fields:t.metadata.columns.map((e=>({name:e.name,type:e.type})))});return e.data.results.forEach((e=>{const t=Object.keys(e).map((t=>e[t]));r.appendRow(t)})),[r]}correctTime(e){let t=e.indexOf("+");return-1!==t?e=e.substring(0,t)+"Z":e.lastIndexOf("Z")!==e.length-1&&(e+="Z"),Date.parse(e)}processQueryResultMetric(e,t){const r=t.metadata,a=[],o={};for(const i of e.data.results){const e=Object.keys(i).map((e=>i[e])),s=this.correctTime(e[r.timeColumnIndex]);for(let i=0;i<r.columns.length;i++){if(i===r.timeColumnIndex||i===r.metricIndex)continue;let l="";-1!==r.metricIndex&&(l=e[r.metricIndex]),(r.columns.length>3||""===l)&&(""!==l&&(l+="-"),l+=r.columns[i].name);let c=o[l];c||(c=new n.MutableDataFrame({refId:t.refId,name:l,fields:[{name:"Time",type:n.FieldType.time},{name:"Value",type:n.FieldType.number}]}),o[l]=c,a.push(c));const u=e[i];c.appendRow([s,u])}}return a}annotationQuery(e){return s((function*(){if(!e.annotation.query)throw new Error("Query missing in annotation definition");const t={rawSql:e.annotation.query,format:"annotation",metadata:{}};return this.doQuery(t,e)})).call(this)}metricFindQuery(e,t){return s((function*(){const r={rawSql:e,format:"search",metadata:{}};return this.doQuery(r,c({},{intervalMs:0,range:{from:"",to:""},scopedVars:{}},t))})).call(this)}applyTemplateVariables(e,t){return u(c({},e),{rawSql:(0,a.getTemplateSrv)().replace(e.rawSql,t,this.interpolateVariable)})}doRequest(e){return s((function*(){e.withCredentials=this.withCredentials,e.headers=this.headers;try{return yield(0,o.lastValueFrom)((0,a.getBackendSrv)().fetch(e))}catch(e){var t;if(console.error("Request failed:",e),404===e.status)throw new Error("SWIS service is not available");if(null===(t=e.data)||void 0===t?void 0:t.Message)throw new Error(e.data.Message);throw e}})).call(this)}constructor(e){super(e),l(this,"url",void 0),l(this,"withCredentials",void 0),l(this,"headers",void 0),this.url=e.url||"",this.withCredentials=e.withCredentials||!1,this.headers={"Content-Type":"application/json"},"string"==typeof e.basicAuth&&e.basicAuth.length>0&&(this.headers.Authorization=e.basicAuth)}}},781:e=>{e.exports=a},884:(e,t,r)=>{e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},893:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var a=void 0!==r.layer;a&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,a&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var o=r.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},942:e=>{e.exports=function(e){var t=e[1],r=e[3];if(!r)return t;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),o="/*# ".concat(a," */");return[t].concat([o]).join("\n")}return[t].join("\n")}},959:e=>{e.exports=o},997:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},s={};function l(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={id:e,exports:{}};return i[e](r,r.exports,l),r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="public/plugins/solarwinds-swis-react-datasource/",l.nc=void 0;var c={};l.r(c),l.d(c,{plugin:()=>Q});var u=l(308),m=l.n(u);l.p=m()&&m().uri?m().uri.slice(0,m().uri.lastIndexOf("/")+1):"public/plugins/solarwinds-swis-react-datasource/";var d=l(781),p=l(739),f=l(959),y=l.n(f),h=l(7);const g={format:"time_series",rawSql:"SELECT TOP 5\n     LastSync, \n     Caption,\n     CPULoad, \n     ResponseTime \nFROM\n     Orion.Nodes"};var v=l(292),b=l.n(v),w=l(893),O=l.n(w),S=l(383),x=l.n(S),E=l(884),T=l.n(E),I=l(88),C=l.n(I),j=l(997),A=l.n(j),M=l(486),P={};P.styleTagTransform=A(),P.setAttributes=T(),P.insert=x().bind(null,"head"),P.domAPI=O(),P.insertStyleElement=C();b()(M.A,P);M.A&&M.A.locals&&M.A.locals;function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){D(e,t,r[t])}))}return e}function R(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Q=new d.DataSourcePlugin(p.SwisDatasource).setConfigEditor((function(e){const{onOptionsChange:t,options:r}=e;return y().createElement(h.DataSourceHttpSettings,{defaultUrl:"https://localhost:17778/SolarWinds/InformationService/v3/Json/",dataSourceConfig:r,onChange:t})})).setQueryEditor((function({query:e,onChange:t,onRunQuery:r,datasource:n}){(0,h.useTheme2)();const[a,o]=(0,f.useState)(!1),[i,s]=(0,f.useState)(!1),[l,c]=(0,f.useState)(null),[u,m]=(0,f.useState)(null),d=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],p=q({},g,e);return y().createElement("div",{className:"gf-form-inline"},y().createElement("div",{className:"gf-form-inline"},y().createElement("div",{className:"gf-form gf-form--grow"},y().createElement(h.CodeEditor,{language:"sql",value:p.rawSql||"",onBlur:()=>{r()},onChange:e=>{t(R(q({},p),{rawSql:e}))},height:"200px",showMiniMap:!1,showLineNumbers:!0}))),y().createElement("div",{className:"gf-form-inline"},y().createElement(h.InlineField,{label:"Format as",labelWidth:16},y().createElement(h.Select,{options:d,value:d.find((e=>e.value===p.format)),onChange:e=>{t(R(q({},p),{format:e.value||"time_series"})),r()},width:16})),y().createElement(h.Button,{variant:"secondary",size:"sm",onClick:()=>s(!i),icon:i?"angle-down":"angle-right"},"Show Help"),l&&y().createElement(h.Button,{variant:"secondary",size:"sm",onClick:()=>o(!a),icon:a?"angle-down":"angle-right"},"Generated SWQL")),a&&l&&y().createElement("div",{className:"gf-form"},y().createElement("pre",{className:"gf-form-pre"},l.sql)),i&&y().createElement(h.Alert,{title:"SWIS Query Help",severity:"info"},y().createElement("pre",null,"Time series:\nWrite SWQL queries to be used as Metric series or regular table. For Series there has to be defined time column. \nAs metric is taken first string column or next data column in row. In case there's multiple data columns, each column is taken as metrix suffix\n\nOptional:\n  - return column named metric to represent the series name.\n  - If multiple value columns are returned the metric column is used as prefix.\n  - If no column named metric is found the column name of the value column is used as series name\n\nTable:\n- return any set of columns\n\nGrafana macros to use:\n- $from - time interval start\n- $to - time interval end\n\nTime Series:\n- for sampling you must use function downsample([timecolumn]). TimeInterval is used from grafanata $__interval variable\n- you must also sort result by time\n\nExample time series query:\nSELECT\n     downsample(ObservationTimeStamp) as time,\n     a.Node.Caption,\n     AVG(AvgLoad) as CpuLoad,\n     AVG(AvgMemoryUsed) as MemoryUsed\nFROM Orion.CPULoad a\nWHERE ObservationTimeStamp BETWEEN $from AND $to\nGROUP BY downsample(ObservationTimeStamp), a.Node.Caption, a.NodeID\nORDER BY time DESC")),u&&y().createElement(h.Alert,{title:"Query Error",severity:"error"},u))})).setAnnotationQueryCtrl((({query:e,onChange:t})=>y().createElement("div",{className:"gf-form-group"},y().createElement("h5",{className:"section-heading"},"Query"),y().createElement(h.InlineField,{grow:!0},y().createElement(h.Input,{value:e||"",onChange:e=>t(e.currentTarget.value),placeholder:"Enter a SWQL query"})))));return c})()));
//# sourceMappingURL=module.js.map